# 2026-02-24 작업 로그 (보안 마스킹 버전)

## 1) 설문 완료 후 로그인 리다이렉트 이슈 수정
- 증상: 반려견 미등록 사용자가 설문 완료 후 로그인하면 대시보드로 즉시 이동하지 않음.
- 원인 분석:
  - Result 화면 로그인 진입 시 `returnTo` 누락.
  - OAuth callback에서 게스트 데이터 마이그레이션 전에 `/auth/me` 분기 평가.
- 변경 파일:
  - `Frontend/src/app/(public)/result/page.tsx`
    - 로그인 진입 경로를 `/login?returnTo=/dashboard`로 변경.
  - `Frontend/src/components/features/result/ConversionCTA.tsx`
    - Kakao OAuth redirectTo를 `/auth/callback?returnTo=/dashboard`로 변경.
  - `Frontend/src/app/login/page.tsx`
    - Kakao OAuth도 `buildRedirectTo()` 사용으로 returnTo 전달 일관화.
  - `Frontend/src/app/auth/callback/page.tsx`
    - callback 초기에 `/auth/migrate-guest` best-effort 호출 추가.
    - `allowedReturnTo`에 `/dashboard` 추가 및 분기 처리 추가.

## 2) 로컬 실행 환경 이슈 대응
- 포트 이슈:
  - 3000 점유 프로세스(PID 8016) 종료 후 포트 해제 확인.
- Fetch 실패 이슈:
  - `Frontend/.env.local`의 API URL placeholder를 로컬 백엔드 URL로 정리.
  - CORS 허용 origin 부족(3001) 확인 및 로컬 허용 범위 확장.

## 3) DB 연결 장애 트러블슈팅
- 증상:
  - `Tenant or user not found`
  - `getaddrinfo failed`
- 조치:
  - Direct host와 Pooler host를 분리 검증.
  - 최종적으로 Supabase Transaction Pooler URI(aws-1, 6543) 기준으로 교정.
  - SQLAlchemy async 연결 테스트로 `select 1` 성공 확인.

## 4) 보안 처리 원칙
- 본 로그/커밋에서는 비밀번호, API 키, 토큰 등 민감값을 기록하지 않음.
- `.env`, `.env.local` 등 민감정보 파일은 이번 원격 푸시 커밋에서 제외.

## 5) 오늘 반영된 운영 규칙 문서
- `AGENTS.md` 신규 추가.
- `CLAUDE.md` 최상단 우선 규칙 1줄 추가.

## 검증 메모
- 리다이렉트 관련 변경은 코드 diff로 확인 완료.
- DB 접속은 로컬 테스트 코드 기준 성공(`CONNECTED 1`) 확인.
